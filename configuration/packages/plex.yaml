automation:
  - alias: Plex Webhook
    initial_state: 'on'
    trigger:
      platform: webhook
      webhook_id: !secret plex_webhook
    action:
     - service: mqtt.publish
       data_template:
         topic: 'plex/update'
         payload_template: "{{ (trigger.data['payload'] | string)[12:][:-2] }}"

  - alias: Plex Webhook As Json
    initial_state: 'on'
    trigger:
      platform: mqtt
      topic: 'plex/update'
    action:
      - service: notify.slackbot
        data_template:
          message: "Plex event: {{ trigger.payload_json.event }} - {{ trigger.payload_json.Player.title }} - {{ trigger.payload_json.Account.title }}"
